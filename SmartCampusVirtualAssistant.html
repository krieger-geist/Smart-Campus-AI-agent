<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Campus AI Assistant</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  height: 100vh; min-width: 320px;
  font-family: 'Plus Jakarta Sans', 'Inter', sans-serif;
  background: linear-gradient(140deg, #1650a2 0%, #f7eae1 100%);
  color: #1b2a47;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px;
}
.main-layout {
  display: flex;
  gap: 28px;
  max-width: 1200px;
  width: 100%;
  min-height: 480px;
  position: relative;
}
.container {
  width: 100%;
  max-width: 420px;
  background: rgba(255,255,255,0.11);
  border-radius: 22px;
  padding: 34px 25px 38px;
  box-shadow: 0 4px 24px rgba(22,80,162,0.11);
  backdrop-filter: blur(8px);
  display: flex;
  flex-direction: column;
  align-items: center;
}
h1 {
  font-size: 2.1rem;
  font-weight: 700;
  text-align: center;
  margin-bottom: 14px;
  user-select: none;
  line-height: 1.3;
}
h1 #name {
  color: #d42b7a;
  font-weight: 900;
  text-shadow: 0 0 8px rgba(212,43,122,0.5);
}
h1 #va {
  background: linear-gradient(90deg,#2bced4,#1650a2);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 700;
  filter: brightness(1.08);
}
.status-message {
  font-size: 1.15rem;
  font-weight: 600;
  color: #1b2a47;
  margin: 20px 0 15px 0;
  user-select: none;
  text-align: center;
  min-height: 28px;
  letter-spacing: 0.01em;
}
.input-area {
  width: 100%;
  position: relative;
  margin-bottom: 0px;
}
input#textInput {
  width: 100%;
  padding: 15px 23px;
  font-size: 1.10rem;
  font-family: 'Plus Jakarta Sans', sans-serif;
  border-radius: 26px;
  border: 2px solid #15a2cf;
  outline: none;
  color: #1b2a47;
  box-shadow: 0 2px 9px rgba(21,145,207,0.17);
  background: white;
  transition: border-color 0.2s;
  font-weight: 500;
}
input#textInput::placeholder {
  color: #7caadf;
  opacity: 1;
  font-size: 1rem;
  font-weight: 500;
  letter-spacing: 0.01em;
}
#predefinedQuestions {
  display: none;
  position: absolute;
  top: calc(100% + 3px);
  left: 0;
  width: 100%;
  background: white;
  border: 1.5px solid #15a2cf;
  border-radius: 0 0 16px 16px;
  box-shadow: 0 6px 12px rgba(21, 145, 207, 0.13);
  max-height: 185px;
  overflow-y: auto;
  z-index: 9;
}
#predefinedQuestions div {
  padding: 12px 20px;
  font-size: 1.03rem;
  color: #1b2a47;
  cursor: pointer;
  user-select: none;
  border-bottom: 1px solid #e1e7f3;
  transition: background-color 0.16s;
  text-align: left;
}
#predefinedQuestions div:hover {
  background-color: #dbefff;
}
#predefinedQuestions div:last-child {
  border-bottom: none;
}
.command-display {
  width: 100%;
  background: rgba(255,255,255,0.96);
  border-radius: 18px;
  padding: 15px 24px;
  font-size: 1.04rem;
  font-weight: 600;
  color: #1b2a47;
  box-shadow: 0 2px 18px #1650a249;
  text-align: center;
  margin: 16px 0 0 0;
}
.actions-row {
  width: 100%; display: flex; justify-content: center; gap: 16px; margin-top: 22px;
}
.button-main {
  background: linear-gradient(110deg,#1650a2 70%,#2bced4 100%);
  padding: 13px 38px;
  border-radius: 33px;
  border: none;
  color: white;
  font-weight: 700;
  font-size: 1.16rem;
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
  box-shadow: 0 6px 20px #1591cf33;
  outline: none;
  display: flex;
  align-items: center;
  gap: 14px;
  user-select: none;
}

.button-main:hover, .button-alt:hover {
  background: linear-gradient(90deg,#2bced4 70%,#1650a2 100%);
  transform: translateY(-2px);
  box-shadow: 0 9px 26px #1591cf44;
}
.button-alt {
  background: linear-gradient(110deg,#d42b7a 60%, #f7eae1 99%);
  color: #1b2a47;
  font-weight: 700;
  outline: none;
  font-size: 1.03rem;
  padding: 13px 28px;
  border-radius: 33px; border: none;
  transition: background 0.2s, transform 0.2s;
  box-shadow: 0 2px 6px #d42b7a22;
  display: flex; align-items: center;
  gap: 12px;
  user-select: none;
}
.button-alt img {
  width: 21px; height: 21px;
  filter: brightness(0) invert(1);
}
.button-main img { width: 26px; height: 26px; filter: brightness(0) invert(1); }

.output-sidebar {
  min-width: 360px;
  max-width: 450px;
  height: 90vh;
  background: rgba(255,255,255,0.98);
  box-shadow: -4px 0 20px rgba(22,80,162,0.13);
  border-radius: 22px;
  padding: 38px 36px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 1.10rem;
  font-weight: 600;
  color: #1650a2;
  margin-left: 0;
  margin-right: 1vw;
  justify-content: flex-start;
  user-select: text;
  overflow-y: auto;
  word-break: break-word;
}
@media (max-width: 990px) {
  .main-layout { flex-direction: column; align-items: center; gap:18px;}
  .output-sidebar {
    min-width: 99vw; max-width: 99vw; height: 30vh;
    border-radius: 19px; box-shadow: none;
    padding: 12px 16px; margin: 1vw 0 0 0;
    overflow-y: auto;
  }
  .container { max-width: 99vw; }
}
.output-sidebar h2 {
  margin-bottom: 19px;
  color: #1591cf;
  font-size: 1.12rem;
  letter-spacing: 0.01em;
}
.output-content {
  white-space: pre-wrap;
  line-height: 1.65;
  width: 100%;
  word-break: break-word;
}
.output-content p {
  margin-bottom: 1.8em; /* Extra gap between paragraphs */
}
</style>
</head>
<body>
<div class="main-layout">
  <div class="container" role="main" aria-label="Smart Campus AI Assistant">
    <h1>
      I'm <span id="name">Smart Campus AI</span>, Your <span id="va">Virtual Assistant</span>
    </h1>
    <div class="status-message" aria-live="polite" aria-atomic="true" id="statusMessage">Ready to assist…</div>
    <div class="input-area">
      <input id="textInput" type="text" autocomplete="off" placeholder="Type your command here…" aria-label="Type your command" />
      <div id="predefinedQuestions" role="listbox" aria-label="Predefined questions"></div>
    </div>
    <div class="command-display" id="content" aria-live="polite">
      You can type or press start to speak…
    </div>
    <div class="actions-row">
      <button id="btn" class="button-main" aria-label="Start Voice Input">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z'/%3E%3Cpath d='M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z'/%3E%3C/svg%3E" alt="microphone icon" />
        <span id="btnText">Start</span>
      </button>
      <button id="stopBtn" class="button-alt" aria-label="Stop Output">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' height='24' viewBox='0 0 24 24' width='24'%3E%3Crect width='18' height='18' x='3' y='3' rx='4'/%3E%3C/svg%3E">
        <span id="btnStopText">Stop</span>
      </button>
    </div>
  </div>
  <aside class="output-sidebar" aria-live="polite" aria-atomic="true" aria-label="Assistant output">
    <h2>Assistant Output</h2>
    <div class="output-content" id="outputContent">Response will appear here…</div>
  </aside>
</div>
<script>
const currentLang = 'en-US';
const statusMessage = document.getElementById('statusMessage');
const outputContent = document.getElementById('outputContent');
const predefinedQuestionsContainer = document.getElementById('predefinedQuestions');
const stopBtn = document.getElementById('stopBtn');
const predefinedQuestions = [
  'Tell me about departments?',
  'How do I apply for scholarships?',
  'Where is the cafeteria located?',
  'What events are happening this week?',
  'How do I contact the administration office?',
  'Tell me about ',
  'What is the Wifi password?',
  'How do I check my exam schedule?'
];
function setStatus(text, color='#1b2a47') {
  statusMessage.textContent = text;
  statusMessage.style.color = color;
}
setStatus('Ready to assist…', '#1b2a47');
const synth = window.speechSynthesis;

function speak(text) {
  if (synth.speaking) synth.cancel();
  if (!text) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = currentLang;
  utter.rate = 1.07;
  utter.pitch = 1;
  synth.speak(utter);
}

function stopAllOutput() {
  if (synth.speaking) synth.cancel();
  outputContent.innerHTML = "<p>Output stopped by you.</p>";
  setStatus('Output and voice assistant stopped.', '#d42b7a');
}

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) { alert('Speech Recognition API not supported in your browser.'); }
const recognition = SpeechRecognition ? new SpeechRecognition() : null;
const btn = document.getElementById('btn');
const content = document.getElementById('content');
const textInput = document.getElementById('textInput');
const n8nWebhookURL = 'https://manassuryavanshi123.app.n8n.cloud/webhook-test/3d-character-input';

function showPredefinedQuestions() {
  predefinedQuestionsContainer.innerHTML = '';
  predefinedQuestions.forEach((q) => {
    const div = document.createElement('div');
    div.textContent = q;
    div.setAttribute('role','option');
    div.tabIndex = 0;
    div.onclick = () => {
      textInput.value = q;
      hidePredefinedQuestions();
      textInput.focus();
    };
    div.onkeydown = (e) => {
      if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); div.click(); }
    };
    predefinedQuestionsContainer.appendChild(div);
  });
  predefinedQuestionsContainer.style.display = 'block';
}
function hidePredefinedQuestions() {
  predefinedQuestionsContainer.style.display = 'none';
}
async function sendToN8nWebhook(command) {
  try {
    const response = await fetch(n8nWebhookURL, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ command: command }),
    });
    if(!response.ok) { console.error('Webhook error:', response.statusText); return "Sorry, there was a problem connecting to the assistant."; }
    const data = await response.json();
    // You can tune backend to always send friendly, student-focused output!
    return data.answer || data.response || data.message || "Sorry, I did not get a valid response.";
  } catch(error) {
    console.error('Webhook error:', error);
    return "Unable to reach the assistant server.";
  }
}
async function takeCommand(message) {
  message = (message||'').trim();
  if (!message) return;
  content.textContent = `You said: "${message}"`;
  textInput.value = '';
  setStatus('Processing…', '#1591cf');
  const responseText = await sendToN8nWebhook(message);
  // Render paragraphs for beautiful campus-friendly output
  outputContent.innerHTML = responseText
    .split(/\n\s*\n/)
    .map(par => `<p>${par.trim()}</p>`)
    .join('');
  speak(responseText);
  setStatus('Ready to assist…', '#1b2a47');
}
if (recognition) {
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = currentLang;
  recognition.onstart = () => { setStatus("Listening…", "#1591cf"); btn.style.display='none'; }
  recognition.onresult = (event) => { const transcript = event.results[0][0].transcript; takeCommand(transcript); }
  recognition.onerror = () => {
    setStatus("Sorry, I didn't catch that. Please try again.", "#d42b7a");
    speak("Sorry, I didn't catch that. Please try again.");
    btn.style.display='flex';
  };
  recognition.onend = () => { setStatus('Ready to assist…', '#1b2a47'); btn.style.display='flex'; }
}
btn.addEventListener('click', () => {
  if (recognition) { recognition.lang = currentLang; recognition.start(); }
  else { alert('Speech Recognition not supported.'); }
});
stopBtn.addEventListener('click', stopAllOutput);
textInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') { e.preventDefault(); takeCommand(textInput.value); hidePredefinedQuestions(); }
});
textInput.addEventListener('focus', showPredefinedQuestions);
document.addEventListener('click', (e)=> {
  if (!textInput.contains(e.target) && !predefinedQuestionsContainer.contains(e.target)) {
    hidePredefinedQuestions();
  }
});
</script>
</body>
</html>
